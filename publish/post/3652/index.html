<!DOCTYPE html>
<html lang="en-us">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='用手机编程，一不小心搞出了个市面上没有的东西。'><title>我受够了这些新闻App，于是加了一点AI</title>

<link rel='canonical' href='http://localhost:1313/post/3652/'>



<link rel="stylesheet" href="../../scss/style.min.594112fc94b40e17b5a86b4ee206a0077216dab56dccf577eab6840808ae9f28.css">
<link rel="stylesheet" href="../../css/custom-override.css"><meta property='og:title' content='我受够了这些新闻App，于是加了一点AI'>
<meta property='og:description' content='用手机编程，一不小心搞出了个市面上没有的东西。'>
<meta property='og:url' content='http://localhost:1313/post/3652/'>
<meta property='og:site_name' content='Victor42'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2024-08-13T13:31:00&#43;00:00'/><meta property='article:modified_time' content='2024-08-13T13:31:00&#43;00:00'/>
        <meta property='og:updated_time' content='2024-08-13T13:31:00&#43;00:00'/><meta property='og:image' content='https://cdn.victor42.work/posts/2024-08/90415a2f2e2fa7829fae2a10f117f392.jpg' />
<meta name="twitter:title" content="我受够了这些新闻App，于是加了一点AI">
<meta name="twitter:description" content="用手机编程，一不小心搞出了个市面上没有的东西。"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://cdn.victor42.work/posts/2024-08/90415a2f2e2fa7829fae2a10f117f392.jpg' />






    







<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http:\/\/localhost:1313\/post\/3652\/"
    },
    "headline": "我受够了这些新闻App，于是加了一点AI",
    "description": "用手机编程，一不小心搞出了个市面上没有的东西。",
    "image": "https:\/\/cdn.victor42.work\/posts\/2024-08\/90415a2f2e2fa7829fae2a10f117f392.jpg",
    "author": {
        "@type": "Person",
        "name": "Victor42"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Victor42",
        "logo": {
            "@type": "ImageObject",
            "url": "http:\/\/localhost:1313\/favicon.ico"
        }
    },
    "datePublished": "2024-08-13T13:31:00\u002b00:00",
    "dateModified": "2024-08-13T13:31:00\u002b00:00",
    "wordCount":  5591 ,
    "timeRequired": "PT18M"
}
</script> 
    <link rel="shortcut icon" href="https://cdn.victor42.work/assets/favicon.ico" />


<script async src="https://www.googletagmanager.com/gtag/js?id=G-H0F3NJJ4RT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-H0F3NJJ4RT');
</script>
    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="../../" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Back</span>
            </a>
        </div>
    
<main class="main full-width">
    
<article class="has-image main-article">
    

<header class="article-header">
    
        <div class="article-image">
            <a href="../../post/3652/">
                
                    <img src="https://cdn.victor42.work/posts/2024-08/90415a2f2e2fa7829fae2a10f117f392.jpg" loading="lazy" alt="Featured image of post 我受够了这些新闻App，于是加了一点AI" />
                
            </a>
        </div>
    

    <div class="article-details">
        <div class="article-header-wrapper">
            
                <div class="article-category">
                    
                        <a href="../../categories/%E6%8A%98%E8%85%BE%E4%B8%8E%E6%80%9D%E8%80%83-geek/">
                            折腾与思考-Geek
                        </a>
                    
                </div>
            

            
                

    <div class="article-lang-switcher">
        
            
            <a href="../../post/en/3652" class="lang-switch-button">
                <span class="lang-switch-icon">🌏</span>
                <span class="lang-switch-text">English</span>
            </a>
        
    </div>
 
            
        </div>

        <div class="article-title-wrapper">
            <h2 class="article-title">
                <a href="../../post/3652/">我受够了这些新闻App，于是加了一点AI</a>
            </h2>

            
                <h3 class="article-subtitle">
                    用手机编程，一不小心搞出了个市面上没有的东西。
                </h3>
            
        </div>

        
            <footer class="article-time">
                
                    <div>
                        <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-calendar"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z" /><path d="M16 3v4" /><path d="M8 3v4" /><path d="M4 11h16" /><path d="M11 15h1" /><path d="M12 15v3" /></svg>
                        <time class="article-time--published">Aug 13, 2024</time>
                    </div>
                

                

                
    <div>
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <time class="article-time--reading">18 minute read
        </time>
    </div>
 
            </footer>
        
    </div>
</header>
    
<section class="article-content">
    
    
    <p><strong>阅读提示：本文涉及Tasker、AI、前端、自动化，有一定技术门槛。</strong></p>
<h2 id="背景">背景</h2>
<p>我有个坚持，不想浪费宝贵时间在低价值信息上，所以会时常反思自己的信息来源。我感兴趣的领域，通常都能找到相应信息渠道，长期关注。但不能只盯着这些领域，也需要一扇小窗口，来偶尔了解其他领域的大事，防止画地为牢。</p>
<p>以往，我都是利用早晨送老婆孩子的时间，听听新闻电台，了解当天时事。这里面的信息也可以分为两类：</p>
<ol>
<li>肯定对我无价值。如体育新闻、娱乐新闻，我一点也不关心体育和八卦；又如军事新闻，军事信息披露少、难查证，各方报喜不报忧，单从新闻报道获得结论，完全不可靠。</li>
<li>可能有价值，听了才知道。如社会新闻，近期消费趋势、科技发展导致的新社会现象等，有时能从中得到一些数据和洞察。当然，也有许多毫无价值，比如某豪车肇事逃逸这种，社会构成形形色色，单个个体的行为往往不值得关心。</li>
</ol>
<p>近期巴黎奥运会，我的新闻时光几乎被奥运新闻淹没了。导致我开车时不时要瞄一眼大屏上的新闻标题，判断是不是该切下一条。有时候要连切7、8条，才能轮到一则我愿意听的。这样既不安全，又让人火大。</p>
<p>我试过许多可以听新闻的手机App。如果听头条频道，免不了混进这些不感兴趣的信息。如果订阅几个特定频道，又总会混入上千字的深度报道，敢情我一路就听你一条呢？更新频率的差异也是个问题，订阅的几个频道中，只要有一两个更新量极大，其他频道就相当于不存在了。</p>
<p>我就想，既然只瞄一眼标题就能判断要不要听，这事儿AI难道不能做吗？我可以继续听头条频道，只是让AI帮我滤掉一道，可不可行？</p>
<p>这个想法一冒出来，就完全停不下来了。</p>
<h2 id="实现思路">实现思路</h2>
<p>仔细一想就发现，这事压根儿没什么技术含量。但就是找不到一款现成产品，可能是需求过于小众，那我就自己干吧！</p>
<p>首先，我要在哪实施我的构想？在电脑上写个程序当然可以，但既然听新闻绕不开手机，干脆整个流程都在手机上完成吧，摆脱对其他设备的依赖，否则我出去度个长假还听不了新闻了？所幸我长期使用Tasker，安卓手机上的一款编程软件，我知道它能实现我想要的效果。</p>
<p>整个过程不复杂，就这么几步：</p>
<ol>
<li>从新闻源获取当日的头条新闻</li>
<li>把新闻标题交给AI，让它判断属于哪类新闻</li>
<li>过滤掉我不要的几类新闻，剩余新闻以文字形式保存下来</li>
<li>通过语音合成转成音频新闻，存到特定位置</li>
<li>以上动作做成自动任务，每天深夜执行一遍</li>
<li>在音乐播放器创建一个专门的歌单，读取音频新闻</li>
<li>做另一个自动任务，手机连上车载蓝牙启动播放器，播放新闻</li>
<li>再做个自动任务，每天把新闻清空，为下一轮做准备</li>
</ol>
<h2 id="准备轮子">准备轮子</h2>
<p>以上步骤听起来像个大工程。但好在我不用自己发明轮子，其中许多能力都有现成的工具，把它们整合进来即可。现在，我得把可能用到的基础能力做成一个个小模块，也就是子任务，提前准备好，便于后续组装。</p>
<h3 id="tasker简介">Tasker简介</h3>
<p>Tasker是这些子任务的载体。它是一个手机上的自动化工具，把硬件控制、数学运算、文件操作、网络请求、判断/循环等能力都打散成原子级别，让你自由组合，构建各种各样的自动化工作流。折腾过iPhone快捷指令的朋友应该熟悉这套玩法，只是Tasker远比快捷指令强大得多。把它归为自动化工具是低估了它，它实际上是个编程软件。</p>
<p>最基础的用法是根据条件来控制手机硬件，比如连上公司WIFI自动静音、连上车载蓝牙启动音乐播放器，这类效果做起来轻轻松松。高级一些的用法，涉及文件操作、网络请求，则需要有编程的思维，但并不需要真的写代码。</p>
<h3 id="网络获取内容">网络获取内容</h3>
<p>第一个子任务需要具备上网的能力，才能浏览新闻源。</p>
<p><strong>输入：新闻源链接</strong><br>
<strong>输出：包含新闻列表的代码</strong></p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/7c717fff18ada6917cc6ddb9ab5acab4.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/7c717fff18ada6917cc6ddb9ab5acab4.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>它用到了Tasker内置的HTTP请求，我没做任何额外处理，只把从新闻源获得的信息原封不动传递给外层任务。为什么要包这么一层，而不是直接用呢？这和子任务的执行优先级有关系，后面组装轮子的时候我会再讲。</p>
<h3 id="解析xml">解析XML</h3>
<p>从RSS新闻源获得的不是直接能读的新闻，而是一堆XML代码，其中包含新闻列表。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/d9b55eddd9d7d7e26b86fffe3dc56a1f.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/d9b55eddd9d7d7e26b86fffe3dc56a1f.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>RSS遵循一种通用的格式，无论哪个新闻源，一条新闻都对应一个item，它的标题、链接、描述分别对应title、link、description。标准的格式，就有标准的办法从中提取信息。</p>
<p>但在解析之前，我还加了另一个子任务，用来规整XML代码的格式。这里需要一点前端知识，因为网页里有时候会遇到代码被写成转义字符的情况，比如左尖括号<code>&lt;</code>被写成<code>&amp;lt;</code>、右尖括号<code>&gt;</code>被写成<code>&amp;gt;</code>。这个子任务可以把转义字符变回常规符号，便于统一处理。</p>
<p><strong>输入：包含转义字符的XML代码</strong><br>
<strong>输出：标准的XML代码</strong></p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/c117f68d572158b87dc54acd03427ad3.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/c117f68d572158b87dc54acd03427ad3.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>下面该解析XML了。这个子任务可以从一堆XML中找到所有相邻的特定标签，提取出它们的内容，每个标签用<code>|||</code>分隔开。</p>
<p><strong>输入：完整XML代码、要提取内容的标签</strong><br>
<strong>输出：所有该标签里的内容</strong></p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/97c487fda93b7ef67d871a58ebd06721.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/97c487fda93b7ef67d871a58ebd06721.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>在我的程序里，我需要它找出所有item里的内容，也就是获取整个新闻列表。外层任务调用它时，把item作为第2参数（%par2）传给它，就能得到所有新闻条目的内容，并且以<code>|||</code>分隔开，便于外层任务进一步拆分处理。</p>
<h3 id="从html提取内容">从HTML提取内容</h3>
<p>刚才的子任务能解析新闻列表，但其中只有标题和链接是真正有用的。RSS新闻源虽然格式统一，各家对于description却有不同理解。有的新闻源把全文都写在了description里，有的只在这写了摘要，正文藏在详情页里。</p>
<p>这个子任务就是为了干这个。给它一个页面的完整HTML代码，再告诉它要提取哪个标签的内容，它就能取出来，把不相干的菜单、评论、广告、页头页尾全撇掉。</p>
<p><strong>输入：完整HTML代码、要提取内容的标签</strong><br>
<strong>输出：第一个该标签里的内容</strong></p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/0f45bc228aba2af149ceeb0c69a67907.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/0f45bc228aba2af149ceeb0c69a67907.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>这个子任务为何这么复杂？因为它要处理HTML标签层层嵌套的情况，这里涉及的前端知识不展开讲了。简单说就是它找到了标签的结尾在哪里，确定了提取内容的范围。整个过程都是靠字符串拆分、替换、拼接来完成的，实现了Javascript里innerHTML的能力。</p>
<p>取出来的正文内容仍然是HTML代码，这就需要另一个子任务来把HTML转成纯文本。这是Tasker自带的能力。</p>
<p><strong>输入：HTML代码</strong><br>
<strong>输出：文本内容</strong></p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/75b7ba16f35c56d3bb121026e9098eeb.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/75b7ba16f35c56d3bb121026e9098eeb.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="ai判断新闻类型">AI判断新闻类型</h3>
<p>前面的子任务是获取、加工内容的基础，但关键的筛选能力还得靠这个子任务，这是整个程序的脑子。</p>
<p><strong>输入：要发给AI的内容、AI模型名称</strong><br>
<strong>输出：AI的回复</strong></p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/05c6c50a2cba1cad021f550344301002.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/05c6c50a2cba1cad021f550344301002.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><a class="link" href="https://console.groq.com/playground"  target="_blank" rel="noopener"
    >Groq的API</a>真的是个好东西，里面有许多好用的开源AI模型。查阅它的文档，调用这些AI模型非常简单。向它发一些文字，它再把生成的文字回给你。等待2秒是因为API有请求限制，一分钟内最多调用30次。</p>
<h3 id="文本转语音">文本转语音</h3>
<p>这个子任务把文本文件批量转成音频文件保存。</p>
<p><strong>输入：文本文件所在目录、音频文件保存目录</strong><br>
<strong>输出：一批音频文件</strong></p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/c1dabc63612d30a30e611297c14b6493.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/c1dabc63612d30a30e611297c14b6493.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>关键步骤用到了Tasker自带的Say To File，文本存为音频文件。需要注意的是，Say To File只是提供了这种操作，合成过程需要的语音合成引擎，Tasker并没有内置。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/995e0fb18649e334014f111ea8be2b8d.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/995e0fb18649e334014f111ea8be2b8d.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>我用了谷歌的本地语音合成引擎，Google Play下载这个App，就能在Tasker里调用。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/07e0c2612c68af093e0a4e5c942ab102.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/07e0c2612c68af093e0a4e5c942ab102.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>实测发现，本地免费语音合成引擎，效果大概只能达到地图软件默认语音包的水准。谷歌这个算其中比较优秀的了，甚至比讯飞的好，尽管还是很生硬。</p>
<h2 id="组装轮子">组装轮子</h2>
<p>几个轮子准备好了，大多难题都已解决，该组装了。</p>
<h3 id="下载并筛选新闻">下载并筛选新闻</h3>
<p>先组装出核心任务，它能从单个新闻源下载新闻，筛选后保存为文本文件，完成整个程序里绝大多数工序。</p>
<p><strong>输入：新闻源地址、详情页正文所在HTML标签</strong><br>
<strong>输出：一批新闻文本文件</strong></p>
<p>我在输入的第2个参数上留了个小彩蛋。输入的如果是<code>&lt;description&gt;</code>，则不去新闻详情页获取正文，而是直接把XML里的description当做正文。这取决于每个新闻源的性质和数据质量，可以定义在它的外层任务上。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/64acc1961ddd336d05f0b9aba63739ec.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/64acc1961ddd336d05f0b9aba63739ec.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>从新闻源获得完整XML代码，把转义字符规整成标准XML，去掉一些特殊的内容标记。然后提取新闻列表。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/b52349abcd5a92bb918c797c3043868a.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/b52349abcd5a92bb918c797c3043868a.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>新闻列表根据分隔符分成数组，设定好AI提示词，设定正文长度上限（过滤掉太长的正文）。开始循环，每条新闻从XML里读出标题，标题转成纯文本，交给AI分类。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/ba4c7edd6576c053b69d271d37f2bd88.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/ba4c7edd6576c053b69d271d37f2bd88.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>AI的提示词我是这么写的，没用到什么技巧，直白说出需求就行。由于这里处理的都是中文信息，Groq上的Gemma2 9b模型比较适合，比Llama3.1的中文能力强。这种简单需求，开源小模型足以胜任。实际使用效果很好，没出过错。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/3e5a40b3c15e4e3661f026de131b45f0.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/3e5a40b3c15e4e3661f026de131b45f0.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>根据AI分的类型来判断，过滤掉体育/娱乐/军事新闻。再从XML得到新闻详情页链接，顺藤摸瓜取得详情页完整HTML，规整代码格式，根据正文所在HTML标签取出其内容。</p>
<p>把正文HTML代码转成文本，判断正文长度，太长的过滤掉，太短的可能是图片新闻也过滤掉。剩下的作为文本文件存到特定目录里。</p>
<h3 id="优先级问题">优先级问题</h3>
<p>调试核心任务的过程中，很多次出现取不到内容的情况，卡了很久。深入研究找到了原因：原来子任务的执行竟然是并行的！</p>
<p>Tasker的灵魂是它的Perform Task，作用是在当前任务里执行一个子任务。执行时可以把当前任务的信息传递给子任务，并获得子任务处理后的结果。</p>
<p>传入参数，获得返回值，这不就是编程里的函数吗？虽然Tasker有限制，最多只能往子任务里传2个参数，但如果把多个参数用特定分隔符拼接成字符串，传到子任务里再拆分开，理论上多少个参数都能传进来。用这种结构层层嵌套，什么复杂的逻辑做不出来？Perform Task的存在，使Tasker成为一款编程软件。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/9fe1b7073ff0b94fab2859978f94ec9f.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/9fe1b7073ff0b94fab2859978f94ec9f.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>仔细阅读了Perform Task的帮助文档，里面提到了执行顺序问题。触发子任务时，外层任务并不会等子任务执行完再继续（我一直这么以为），而是并行执行下去了。我的程序中，许多子任务要去网上获取内容，或对页面代码进行大量的循环处理，耗费时间很长。在子任务给出处理结果前，外层任务继续执行，当然就接不上了。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/1091748819015f7296ec93d7500e5475.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/1091748819015f7296ec93d7500e5475.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>按照帮助文档里建议的做法，把子任务Priority属性设为%priority+1，让子任务的优先级数值比外层任务多1，这样外层任务就会等子任务执行完才继续。</p>
<h3 id="多渠道下载新闻">多渠道下载新闻</h3>
<p>呼~ 好长一个任务写完了，现在来调用它。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/a0a90a2ca998bca90156e3cfe59040b5.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/a0a90a2ca998bca90156e3cfe59040b5.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>把我选出的几个RSS新闻源传递给核心任务，从哪里取正文也告诉它。每个新闻源都执行一次。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/d6d37dbe8a8195e2d6c7674104fc533f.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/d6d37dbe8a8195e2d6c7674104fc533f.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>再单独做一个批量转语音的任务，把文本新闻的目录和音频新闻的目录都告诉它，让它往音频新闻目录里输出。</p>
<h3 id="定时下载并转语音">定时下载并转语音</h3>
<p>上面都是任务，怎么启动它们呢？切换到Tasker的Profiles页面，这里可以为任务添加各种各样的触发条件。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/bf1751cc5b2863826ff82d819e8b8859.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/bf1751cc5b2863826ff82d819e8b8859.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>每天凌晨4点，把新闻都存成文本文件。这个过程要5-10分钟。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/e1f5ef475b315060c9a3679f7a0e0603.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/e1f5ef475b315060c9a3679f7a0e0603.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>每天凌晨5点，把文本新闻转成音频。</p>
<h2 id="最终效果">最终效果</h2>
<p>这样我一觉醒来，News目录下就有两个文件夹。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/7add1606a97bddcc6fdee7af42f71cb1.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/7add1606a97bddcc6fdee7af42f71cb1.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>text保存了文字版新闻，如果有需要我还能二次分享出去。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/4d00497b3a8e5554ff90aeccfe11dcbd.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/4d00497b3a8e5554ff90aeccfe11dcbd.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>audio文件夹里是音频新闻。虽然还有一些没什么意思的社会新闻混在其中，但这不能怪AI，至少我再也没有听到过体育新闻了。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/fb2a13c2d652d15b0653f2e39be0beea.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/fb2a13c2d652d15b0653f2e39be0beea.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>手机上的音乐播放器里新建了一个叫每日新闻的歌单，专门读取audio文件夹。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/90415a2f2e2fa7829fae2a10f117f392.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/90415a2f2e2fa7829fae2a10f117f392.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>更新一下内容，当天新闻就都来了。这个更新过程仍然需要手动点一下，我还在找自动化的办法。</p>
<p><figure 
	>
	<a href="https://cdn.victor42.work/posts/2024-08/0023ce1bc26cb0c58b78cab5d834c033.jpg" >
		<img src="https://cdn.victor42.work/posts/2024-08/0023ce1bc26cb0c58b78cab5d834c033.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>播新闻也是自动的。早晨连上车载蓝牙，播放器就自动打开了，而我用的<a class="link" href="https://play.google.com/store/search?q=AIMP&amp;c=apps"  target="_blank" rel="noopener"
    >AIMP播放器</a>能设置打开自动播放，这下就完全不用动手了。</p>
<p>最后，我还有另一个自动任务，每天凌晨3点把新闻文件夹清空，为下一轮任务做准备。</p>
<h2 id="后记">后记</h2>
<p>用了几天自制的新闻头条程序，这下舒坦了，开车不用分心了。除了语音比较生硬之外，其他毛病没有。语音嘛也许等哪天我受不了了，就再找个效果好的付费TTS API，把Say To File这一步替换掉就可以了。</p>
<p>一番操作下来，不仅解决了我生活中的问题，还积累了一些有用的子任务。我在制作网络获取内容、解析XML、从HTML提取内容、向AI提问这些子任务时，充分考虑了通用性。未来还能组装出其他程序，在手机上轻松实现各种网络爬虫，甚至AI agent。手机上的网络爬虫真的香，没有任何服务器费用，还能实现全天候运行，以后有具体需求再折腾吧。</p>
<h2 id="资源下载">资源下载</h2>
<p>其中用到的比较复杂的Task已经公开分享，可随意取用。部分过于简单的Task就没有放上来，用内置的Task就能实现。</p>
<p>Bulk TTS:
<a class="link" href="https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3ABulk&#43;TTS"  target="_blank" rel="noopener"
    >https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3ABulk+TTS</a></p>
<p>Fix XML format:
<a class="link" href="https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3AFix&#43;XML&#43;format"  target="_blank" rel="noopener"
    >https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3AFix+XML+format</a></p>
<p>API- Groq (enter your key):
<a class="link" href="https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3AAPI&#43;-&#43;Groq&#43;%28enter&#43;your&#43;key%29"  target="_blank" rel="noopener"
    >https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3AAPI+-+Groq+%28enter+your+key%29</a></p>
<p>Fix file name:
<a class="link" href="https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3AFix&#43;file&#43;name"  target="_blank" rel="noopener"
    >https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3AFix+file+name</a></p>
<p>Get inner XML(all siblings):
<a class="link" href="https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3AGet&#43;inner&#43;XML%28all&#43;siblings%29"  target="_blank" rel="noopener"
    >https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3AGet+inner+XML%28all+siblings%29</a></p>
<p>Get inner XML(first match):
<a class="link" href="https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3AGet&#43;inner&#43;XML%28first&#43;match%29"  target="_blank" rel="noopener"
    >https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3AGet+inner+XML%28first+match%29</a></p>
<p>从RSS下载特定分类新闻:
<a class="link" href="https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3A%E4%BB%8ERSS%E4%B8%8B%E8%BD%BD%E7%89%B9%E5%AE%9A%E5%88%86%E7%B1%BB%E6%96%B0%E9%97%BB"  target="_blank" rel="noopener"
    >https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3A%E4%BB%8ERSS%E4%B8%8B%E8%BD%BD%E7%89%B9%E5%AE%9A%E5%88%86%E7%B1%BB%E6%96%B0%E9%97%BB</a></p>
<p>多渠道下载新闻:
<a class="link" href="https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3A%E5%A4%9A%E6%B8%A0%E9%81%93%E4%B8%8B%E8%BD%BD%E6%96%B0%E9%97%BB"  target="_blank" rel="noopener"
    >https://taskernet.com/shares/?user=AS35m8mopd%2Bc1C7UhZNzgAc6Ld0oCTR8LzUJsfqb7SGyZq7NWeHANGDjDvTtBPSkNCjn3CrFQoI%3D&amp;id=Task%3A%E5%A4%9A%E6%B8%A0%E9%81%93%E4%B8%8B%E8%BD%BD%E6%96%B0%E9%97%BB</a></p>

</section>



    <footer class="article-footer">
    

    </footer>


    
</article>

    

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="has-image">
    <a href="../../post/3654/">
        
        
            <div class="article-image">
                
                    <img src="https://cdn.victor42.work/posts/2024-08/6cab50470236b0d2d7a8937ab39753e1.jpg" loading="lazy" data-key="" data-hash="https://cdn.victor42.work/posts/2024-08/6cab50470236b0d2d7a8937ab39753e1.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">老婆和同事搜不到东西时总找我</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="../../post/3653/">
        
        

        <div class="article-details">
            <h2 class="article-title">我们这代人的遗言会写在哪里？</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="../../post/3651/">
        
        
            <div class="article-image">
                
                    <img src="https://cdn.victor42.work/posts/2024-07/ea6d9ff8fee7f0f2477d458be8c4a952.jpg" loading="lazy" data-key="" data-hash="https://cdn.victor42.work/posts/2024-07/ea6d9ff8fee7f0f2477d458be8c4a952.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">关于英语的重音，我做了一个深入研究……</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="../../post/3650/">
        
        
            <div class="article-image">
                
                    <img src="https://cdn.victor42.work/posts/2024-06/927f0f7ac6f154b4027673e30b629be2.jpg" loading="lazy" data-key="" data-hash="https://cdn.victor42.work/posts/2024-06/927f0f7ac6f154b4027673e30b629be2.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">我用Excel把PS变成了一挺重机枪</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="../../post/3649/">
        
        
            <div class="article-image">
                
                    <img src="https://cdn.victor42.work/posts/2024-03/27b2a2b1d435b113.jpg" loading="lazy" data-key="" data-hash="https://cdn.victor42.work/posts/2024-03/27b2a2b1d435b113.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">AI生物学家</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>


    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2011 - 
        
        2025 Victor42
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.7.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>

    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">Table of contents</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#背景">背景</a></li>
    <li><a href="#实现思路">实现思路</a></li>
    <li><a href="#准备轮子">准备轮子</a>
      <ul>
        <li><a href="#tasker简介">Tasker简介</a></li>
        <li><a href="#网络获取内容">网络获取内容</a></li>
        <li><a href="#解析xml">解析XML</a></li>
        <li><a href="#从html提取内容">从HTML提取内容</a></li>
        <li><a href="#ai判断新闻类型">AI判断新闻类型</a></li>
        <li><a href="#文本转语音">文本转语音</a></li>
      </ul>
    </li>
    <li><a href="#组装轮子">组装轮子</a>
      <ul>
        <li><a href="#下载并筛选新闻">下载并筛选新闻</a></li>
        <li><a href="#优先级问题">优先级问题</a></li>
        <li><a href="#多渠道下载新闻">多渠道下载新闻</a></li>
        <li><a href="#定时下载并转语音">定时下载并转语音</a></li>
      </ul>
    </li>
    <li><a href="#最终效果">最终效果</a></li>
    <li><a href="#后记">后记</a></li>
    <li><a href="#资源下载">资源下载</a></li>
  </ul>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="../../ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
